!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var e=new/*#__PURE__*/(function(){var e;function r(t){var e=this;!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,r),this.size=4,this._emptyBoard=function(){return Array.from({length:e.size},function(){return Array(e.size).fill(0)})},this.field=this._emptyBoard(),this.score=0,this.status="idle",Array.isArray(t)?this.field=t.map(function(t){return t.slice()}):t&&Array.isArray(t.field)&&(this.field=t.field.map(function(t){return t.slice()}),this.score=Number(t.score||0),this.status=t.status||"idle"),this._initialField=this.field.map(function(t){return t.slice()})}return e=[{key:"_cloneField",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.field;return t.map(function(t){return t.slice()})}},{key:"_emptyCells",value:function(){for(var t=[],e=0;e<this.size;e++)for(var r=0;r<this.size;r++)0===this.field[e][r]&&t.push([e,r]);return t}},{key:"_spawnRandomTile",value:function(){var e=this._emptyCells();if(e.length){var r,n=function(t){if(Array.isArray(t))return t}(r=e[Math.floor(Math.random()*e.length)])||function(t,e){var r,n,i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var s=[],a=!0,o=!1;try{for(i=i.call(t);!(a=(r=i.next()).done)&&(s.push(r.value),2!==s.length);a=!0);}catch(t){o=!0,n=t}finally{try{a||null==i.return||i.return()}finally{if(o)throw n}}return s}}(r,2)||function(e,r){if(e){if("string"==typeof e)return t(e,2);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t(e,2)}}(r,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=n[0],s=n[1];this.field[i][s]=.9>Math.random()?2:4}}},{key:"_transpose",value:function(t){for(var e=this._emptyBoard(),r=0;r<this.size;r++)for(var n=0;n<this.size;n++)e[n][r]=t[r][n];return e}},{key:"_rowsEqual",value:function(t,e){for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}},{key:"_has2048",value:function(){for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++)if(2048===this.field[t][e])return!0;return!1}},{key:"_hasMoves",value:function(){if(this._emptyCells().length)return!0;for(var t=0;t<this.size;t++)for(var e=0;e<this.size;e++){var r=this.field[t][e];if(t+1<this.size&&this.field[t+1][e]===r||e+1<this.size&&this.field[t][e+1]===r)return!0}return!1}},{key:"_compressAndMergeRowLeft",value:function(t){for(var e=t.filter(function(t){return 0!==t}),r=[],n=0,i=0;i<e.length;i++)if(e[i]===e[i+1]){var s=2*e[i];r.push(s),n+=s,i++}else r.push(e[i]);for(;r.length<this.size;)r.push(0);return{row:r,gained:n}}},{key:"_moveLeftCore",value:function(t){for(var e=[],r=0,n=!1,i=0;i<this.size;i++){var s=this._compressAndMergeRowLeft(t[i]),a=s.row,o=s.gained;e.push(a),r+=o,this._rowsEqual(t[i],a)||(n=!0)}return{matrix:e,changed:n,totalGained:r}}},{key:"_applyMove",value:function(t){return!!t.changed&&(this.field=t.matrix,t.totalGained>0&&(this.score+=t.totalGained),this._spawnRandomTile(),this._has2048()?this.status="win":this._hasMoves()||(this.status="lose"),!0)}},{key:"getState",value:function(){return this._cloneField()}},{key:"getScore",value:function(){return this.score}},{key:"getStatus",value:function(){return"running"===this.status?"playing":this.status}},{key:"start",value:function(){this.status="running",this._spawnRandomTile(),this._spawnRandomTile()}},{key:"restart",value:function(){this.field=this._initialField.map(function(t){return t.slice()}),this.score=0,this.status="idle"}},{key:"moveLeft",value:function(){if("running"!==this.status)return!1;var t=this._moveLeftCore(this.field);return this._applyMove(t)}},{key:"moveRight",value:function(){if("running"!==this.status)return!1;var t=this.field.map(function(t){return t.slice().reverse()}),e=this._moveLeftCore(t);return e.matrix=e.matrix.map(function(t){return t.reverse()}),this._applyMove(e)}},{key:"moveUp",value:function(){if("running"!==this.status)return!1;var t=this._transpose(this.field),e=this._moveLeftCore(t);return e.matrix=this._transpose(e.matrix),this._applyMove(e)}},{key:"moveDown",value:function(){if("running"!==this.status)return!1;var t=this._transpose(this.field).map(function(t){return t.reverse()}),e=this._moveLeftCore(t);return e.matrix=this._transpose(e.matrix.map(function(t){return t.reverse()})),this._applyMove(e)}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(r.prototype,e),r}()),r=Array.from(document.querySelector(".game-field").querySelectorAll(".field-row")).map(function(t){return Array.from(t.querySelectorAll(".field-cell"))}),n=document.querySelector(".game-score"),i=document.querySelector(".message-start"),s=document.querySelector(".message-win"),a=document.querySelector(".message-lose"),o=document.querySelector(".button");function u(t){n.textContent=t,n.setAttribute("value",t)}function l(){var t,n,o;!function(){for(var t=e.getState(),n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++){var s=r[n][i],a=t[n][i];s.className="field-cell",s.textContent=a?String(a):"",a&&s.classList.add("field-cell--".concat(a))}}(),t=e.getStatus(),i.classList.add("hidden"),s.classList.add("hidden"),a.classList.add("hidden"),"idle"===t&&i.classList.remove("hidden"),"win"===t&&s.classList.remove("hidden"),"lose"===t&&a.classList.remove("hidden"),n=e.getStatus(),o=e.getScore(),"idle"===n?u(""):"playing"===n&&0===o?u(""):u(String(o))}o.addEventListener("click",function(){o.classList.contains("start")?(e.start(),o.classList.remove("start"),o.classList.add("restart"),o.textContent="Restart"):(e.restart(),o.classList.remove("restart"),o.classList.add("start"),o.textContent="Start"),l()}),document.addEventListener("keydown",function(t){if(["playing","running"].includes(e.getStatus())){var r={ArrowLeft:function(){return e.moveLeft()},ArrowRight:function(){return e.moveRight()},ArrowUp:function(){return e.moveUp()},ArrowDown:function(){return e.moveDown()}}[t.key];r&&(r(),l())}}),l()}();
//# sourceMappingURL=index.8b80943c.js.map
