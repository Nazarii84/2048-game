const t=new class{constructor(t){this.size=4,this._emptyBoard=()=>Array.from({length:this.size},()=>Array(this.size).fill(0)),this.field=this._emptyBoard(),this.score=0,this.status="idle",Array.isArray(t)?this.field=t.map(t=>t.slice()):t&&Array.isArray(t.field)&&(this.field=t.field.map(t=>t.slice()),this.score=Number(t.score||0),this.status=t.status||"idle"),this._initialField=this.field.map(t=>t.slice())}_cloneField(t=this.field){return t.map(t=>t.slice())}_emptyCells(){let t=[];for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++)0===this.field[e][s]&&t.push([e,s]);return t}_spawnRandomTile(){let t=this._emptyCells();if(!t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.field[e][s]=.9>Math.random()?2:4}_transpose(t){let e=this._emptyBoard();for(let s=0;s<this.size;s++)for(let i=0;i<this.size;i++)e[i][s]=t[s][i];return e}_rowsEqual(t,e){for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}_has2048(){for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++)if(2048===this.field[t][e])return!0;return!1}_hasMoves(){if(this._emptyCells().length)return!0;for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let s=this.field[t][e];if(t+1<this.size&&this.field[t+1][e]===s||e+1<this.size&&this.field[t][e+1]===s)return!0}return!1}_compressAndMergeRowLeft(t){let e=t.filter(t=>0!==t),s=[],i=0;for(let t=0;t<e.length;t++)if(e[t]===e[t+1]){let r=2*e[t];s.push(r),i+=r,t++}else s.push(e[t]);for(;s.length<this.size;)s.push(0);return{row:s,gained:i}}_moveLeftCore(t){let e=[],s=0,i=!1;for(let r=0;r<this.size;r++){let{row:l,gained:n}=this._compressAndMergeRowLeft(t[r]);e.push(l),s+=n,this._rowsEqual(t[r],l)||(i=!0)}return{matrix:e,changed:i,totalGained:s}}_applyMove(t){return!!t.changed&&(this.field=t.matrix,t.totalGained>0&&(this.score+=t.totalGained),this._spawnRandomTile(),this._has2048()?this.status="win":this._hasMoves()||(this.status="lose"),!0)}getState(){return this._cloneField()}getScore(){return this.score}getStatus(){return"running"===this.status?"playing":this.status}start(){this.status="running",this._spawnRandomTile(),this._spawnRandomTile()}restart(){this.field=this._initialField.map(t=>t.slice()),this.score=0,this.status="idle"}moveLeft(){if("running"!==this.status)return!1;let t=this._moveLeftCore(this.field);return this._applyMove(t)}moveRight(){if("running"!==this.status)return!1;let t=this.field.map(t=>t.slice().reverse()),e=this._moveLeftCore(t);return e.matrix=e.matrix.map(t=>t.reverse()),this._applyMove(e)}moveUp(){if("running"!==this.status)return!1;let t=this._transpose(this.field),e=this._moveLeftCore(t);return e.matrix=this._transpose(e.matrix),this._applyMove(e)}moveDown(){if("running"!==this.status)return!1;let t=this._transpose(this.field).map(t=>t.reverse()),e=this._moveLeftCore(t);return e.matrix=this._transpose(e.matrix.map(t=>t.reverse())),this._applyMove(e)}},e=Array.from(document.querySelector(".game-field").querySelectorAll(".field-row")).map(t=>Array.from(t.querySelectorAll(".field-cell"))),s=document.querySelector(".game-score"),i=document.querySelector(".message-start"),r=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),n=document.querySelector(".button");function a(t){s.textContent=t,s.setAttribute("value",t)}function o(){!function(){let s=t.getState();for(let t=0;t<s.length;t++)for(let i=0;i<s[t].length;i++){let r=e[t][i],l=s[t][i];r.className="field-cell",r.textContent=l?String(l):"",l&&r.classList.add(`field-cell--${l}`)}}(),function(){let e=t.getStatus();i.classList.add("hidden"),r.classList.add("hidden"),l.classList.add("hidden"),"idle"===e&&i.classList.remove("hidden"),"win"===e&&r.classList.remove("hidden"),"lose"===e&&l.classList.remove("hidden")}(),function(){let e=t.getStatus(),s=t.getScore();"idle"===e?a(""):"playing"===e&&0===s?a(""):a(String(s))}()}n.addEventListener("click",()=>{n.classList.contains("start")?(t.start(),n.classList.remove("start"),n.classList.add("restart"),n.textContent="Restart"):(t.restart(),n.classList.remove("restart"),n.classList.add("start"),n.textContent="Start"),o()}),document.addEventListener("keydown",e=>{if(!["playing","running"].includes(t.getStatus()))return;let s={ArrowLeft:()=>t.moveLeft(),ArrowRight:()=>t.moveRight(),ArrowUp:()=>t.moveUp(),ArrowDown:()=>t.moveDown()}[e.key];s&&(s(),o())}),o();
//# sourceMappingURL=index.3bcff11c.js.map
