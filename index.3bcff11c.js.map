{"mappings":"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","sources":["<anon>","src/scripts/main.js","src/modules/Game.class.js"],"sourcesContent":["class $a5fd07fa01589658$var$Game {\n    constructor(initialState){\n        this.size = 4;\n        this._emptyBoard = ()=>Array.from({\n                length: this.size\n            }, ()=>Array(this.size).fill(0));\n        this.field = this._emptyBoard();\n        this.score = 0;\n        this.status = \"idle\";\n        if (Array.isArray(initialState)) this.field = initialState.map((r)=>r.slice());\n        else if (initialState && Array.isArray(initialState.field)) {\n            this.field = initialState.field.map((r)=>r.slice());\n            this.score = Number(initialState.score || 0);\n            this.status = initialState.status || \"idle\";\n        }\n        this._initialField = this.field.map((r)=>r.slice());\n    }\n    _cloneField(field = this.field) {\n        return field.map((r)=>r.slice());\n    }\n    _emptyCells() {\n        const res = [];\n        for(let r = 0; r < this.size; r++){\n            for(let c = 0; c < this.size; c++)if (this.field[r][c] === 0) res.push([\n                r,\n                c\n            ]);\n        }\n        return res;\n    }\n    _spawnRandomTile() {\n        const empties = this._emptyCells();\n        if (!empties.length) return;\n        const [r, c] = empties[Math.floor(Math.random() * empties.length)];\n        this.field[r][c] = Math.random() < 0.9 ? 2 : 4;\n    }\n    _transpose(mat) {\n        const t = this._emptyBoard();\n        for(let r = 0; r < this.size; r++)for(let c = 0; c < this.size; c++)t[c][r] = mat[r][c];\n        return t;\n    }\n    _rowsEqual(a, b) {\n        for(let i = 0; i < a.length; i++){\n            if (a[i] !== b[i]) return false;\n        }\n        return true;\n    }\n    _has2048() {\n        for(let r = 0; r < this.size; r++)for(let c = 0; c < this.size; c++){\n            if (this.field[r][c] === 2048) return true;\n        }\n        return false;\n    }\n    _hasMoves() {\n        if (this._emptyCells().length) return true;\n        for(let r = 0; r < this.size; r++)for(let c = 0; c < this.size; c++){\n            const v = this.field[r][c];\n            if (r + 1 < this.size && this.field[r + 1][c] === v) return true;\n            if (c + 1 < this.size && this.field[r][c + 1] === v) return true;\n        }\n        return false;\n    }\n    _compressAndMergeRowLeft(row) {\n        const vals = row.filter((x)=>x !== 0);\n        const res = [];\n        let gained = 0;\n        for(let i = 0; i < vals.length; i++)if (vals[i] === vals[i + 1]) {\n            const merged = vals[i] * 2;\n            res.push(merged);\n            gained += merged;\n            i++;\n        } else res.push(vals[i]);\n        while(res.length < this.size)res.push(0);\n        return {\n            row: res,\n            gained: gained\n        };\n    }\n    _moveLeftCore(matrix) {\n        const newMat = [];\n        let totalGained = 0;\n        let changed = false;\n        for(let r = 0; r < this.size; r++){\n            const { row: newRow, gained: gained } = this._compressAndMergeRowLeft(matrix[r]);\n            newMat.push(newRow);\n            totalGained += gained;\n            if (!this._rowsEqual(matrix[r], newRow)) changed = true;\n        }\n        return {\n            matrix: newMat,\n            changed: changed,\n            totalGained: totalGained\n        };\n    }\n    _applyMove(result) {\n        if (!result.changed) return false;\n        this.field = result.matrix;\n        if (result.totalGained > 0) this.score += result.totalGained;\n        this._spawnRandomTile();\n        if (this._has2048()) this.status = \"win\";\n        else if (!this._hasMoves()) this.status = \"lose\";\n        return true;\n    }\n    getState() {\n        return this._cloneField();\n    }\n    getScore() {\n        return this.score;\n    }\n    getStatus() {\n        if (this.status === \"running\") return \"playing\";\n        return this.status;\n    }\n    start() {\n        this.status = \"running\";\n        this._spawnRandomTile();\n        this._spawnRandomTile();\n    }\n    restart() {\n        this.field = this._initialField.map((r)=>r.slice());\n        this.score = 0;\n        this.status = \"idle\";\n    }\n    moveLeft() {\n        if (this.status !== \"running\") return false;\n        const res = this._moveLeftCore(this.field);\n        return this._applyMove(res);\n    }\n    moveRight() {\n        if (this.status !== \"running\") return false;\n        const reversed = this.field.map((r)=>r.slice().reverse());\n        const res = this._moveLeftCore(reversed);\n        res.matrix = res.matrix.map((r)=>r.reverse());\n        return this._applyMove(res);\n    }\n    moveUp() {\n        if (this.status !== \"running\") return false;\n        const t = this._transpose(this.field);\n        const res = this._moveLeftCore(t);\n        res.matrix = this._transpose(res.matrix);\n        return this._applyMove(res);\n    }\n    moveDown() {\n        if (this.status !== \"running\") return false;\n        const t = this._transpose(this.field).map((r)=>r.reverse());\n        const res = this._moveLeftCore(t);\n        res.matrix = this._transpose(res.matrix.map((r)=>r.reverse()));\n        return this._applyMove(res);\n    }\n}\nvar $a5fd07fa01589658$export$2e2bcd8739ae039 = $a5fd07fa01589658$var$Game;\n\n\nconst $09e991522ca7e64e$var$game = new (0, $a5fd07fa01589658$export$2e2bcd8739ae039)();\nconst $09e991522ca7e64e$var$fieldTable = document.querySelector(\".game-field\");\nconst $09e991522ca7e64e$var$rows = Array.from($09e991522ca7e64e$var$fieldTable.querySelectorAll(\".field-row\"));\nconst $09e991522ca7e64e$var$cells = $09e991522ca7e64e$var$rows.map((r)=>Array.from(r.querySelectorAll(\".field-cell\")));\nconst $09e991522ca7e64e$var$scoreEl = document.querySelector(\".game-score\");\nconst $09e991522ca7e64e$var$startMsg = document.querySelector(\".message-start\");\nconst $09e991522ca7e64e$var$winMsg = document.querySelector(\".message-win\");\nconst $09e991522ca7e64e$var$loseMsg = document.querySelector(\".message-lose\");\nconst $09e991522ca7e64e$var$btn = document.querySelector(\".button\");\nfunction $09e991522ca7e64e$var$setScoreText(str) {\n    $09e991522ca7e64e$var$scoreEl.textContent = str;\n    $09e991522ca7e64e$var$scoreEl.setAttribute(\"value\", str);\n}\nfunction $09e991522ca7e64e$var$renderField() {\n    const state = $09e991522ca7e64e$var$game.getState();\n    for(let r = 0; r < state.length; r++)for(let c = 0; c < state[r].length; c++){\n        const td = $09e991522ca7e64e$var$cells[r][c];\n        const v = state[r][c];\n        td.className = \"field-cell\";\n        td.textContent = v ? String(v) : \"\";\n        if (v) td.classList.add(`field-cell--${v}`);\n    }\n}\nfunction $09e991522ca7e64e$var$renderMessages() {\n    const st = $09e991522ca7e64e$var$game.getStatus();\n    $09e991522ca7e64e$var$startMsg.classList.add(\"hidden\");\n    $09e991522ca7e64e$var$winMsg.classList.add(\"hidden\");\n    $09e991522ca7e64e$var$loseMsg.classList.add(\"hidden\");\n    if (st === \"idle\") $09e991522ca7e64e$var$startMsg.classList.remove(\"hidden\");\n    if (st === \"win\") $09e991522ca7e64e$var$winMsg.classList.remove(\"hidden\");\n    if (st === \"lose\") $09e991522ca7e64e$var$loseMsg.classList.remove(\"hidden\");\n}\nfunction $09e991522ca7e64e$var$renderScore() {\n    const st = $09e991522ca7e64e$var$game.getStatus();\n    const val = $09e991522ca7e64e$var$game.getScore();\n    if (st === \"idle\") $09e991522ca7e64e$var$setScoreText(\"\");\n    else if (st === \"playing\" && val === 0) $09e991522ca7e64e$var$setScoreText(\"\");\n    else $09e991522ca7e64e$var$setScoreText(String(val));\n}\nfunction $09e991522ca7e64e$var$renderAll() {\n    $09e991522ca7e64e$var$renderField();\n    $09e991522ca7e64e$var$renderMessages();\n    $09e991522ca7e64e$var$renderScore();\n}\n$09e991522ca7e64e$var$btn.addEventListener(\"click\", ()=>{\n    if ($09e991522ca7e64e$var$btn.classList.contains(\"start\")) {\n        $09e991522ca7e64e$var$game.start();\n        $09e991522ca7e64e$var$btn.classList.remove(\"start\");\n        $09e991522ca7e64e$var$btn.classList.add(\"restart\");\n        $09e991522ca7e64e$var$btn.textContent = \"Restart\";\n        $09e991522ca7e64e$var$renderAll();\n    } else {\n        $09e991522ca7e64e$var$game.restart();\n        $09e991522ca7e64e$var$btn.classList.remove(\"restart\");\n        $09e991522ca7e64e$var$btn.classList.add(\"start\");\n        $09e991522ca7e64e$var$btn.textContent = \"Start\";\n        $09e991522ca7e64e$var$renderAll();\n    }\n});\ndocument.addEventListener(\"keydown\", (e)=>{\n    const st = $09e991522ca7e64e$var$game.getStatus();\n    if (![\n        \"playing\",\n        \"running\"\n    ].includes(st)) return;\n    const map = {\n        ArrowLeft: ()=>$09e991522ca7e64e$var$game.moveLeft(),\n        ArrowRight: ()=>$09e991522ca7e64e$var$game.moveRight(),\n        ArrowUp: ()=>$09e991522ca7e64e$var$game.moveUp(),\n        ArrowDown: ()=>$09e991522ca7e64e$var$game.moveDown()\n    };\n    const fn = map[e.key];\n    if (fn) {\n        fn();\n        $09e991522ca7e64e$var$renderAll();\n    }\n});\n$09e991522ca7e64e$var$renderAll();\n\n\n//# sourceMappingURL=index.3bcff11c.js.map\n","import Game from '../modules/Game.class.js';\n\nconst game = new Game();\n\nconst fieldTable = document.querySelector('.game-field');\nconst rows = Array.from(fieldTable.querySelectorAll('.field-row'));\nconst cells = rows.map((r) => Array.from(r.querySelectorAll('.field-cell')));\n\nconst scoreEl = document.querySelector('.game-score');\nconst startMsg = document.querySelector('.message-start');\nconst winMsg = document.querySelector('.message-win');\nconst loseMsg = document.querySelector('.message-lose');\nconst btn = document.querySelector('.button');\n\nfunction setScoreText(str) {\n  scoreEl.textContent = str;\n  scoreEl.setAttribute('value', str);\n}\n\nfunction renderField() {\n  const state = game.getState();\n\n  for (let r = 0; r < state.length; r++) {\n    for (let c = 0; c < state[r].length; c++) {\n      const td = cells[r][c];\n      const v = state[r][c];\n\n      td.className = 'field-cell';\n      td.textContent = v ? String(v) : '';\n\n      if (v) {\n        td.classList.add(`field-cell--${v}`);\n      }\n    }\n  }\n}\n\nfunction renderMessages() {\n  const st = game.getStatus();\n\n  startMsg.classList.add('hidden');\n  winMsg.classList.add('hidden');\n  loseMsg.classList.add('hidden');\n\n  if (st === 'idle') {\n    startMsg.classList.remove('hidden');\n  }\n\n  if (st === 'win') {\n    winMsg.classList.remove('hidden');\n  }\n\n  if (st === 'lose') {\n    loseMsg.classList.remove('hidden');\n  }\n}\n\nfunction renderScore() {\n  const st = game.getStatus();\n  const val = game.getScore();\n\n  if (st === 'idle') {\n    setScoreText('');\n  } else if (st === 'playing' && val === 0) {\n    setScoreText('');\n  } else {\n    setScoreText(String(val));\n  }\n}\n\nfunction renderAll() {\n  renderField();\n  renderMessages();\n  renderScore();\n}\n\nbtn.addEventListener('click', () => {\n  if (btn.classList.contains('start')) {\n    game.start();\n    btn.classList.remove('start');\n    btn.classList.add('restart');\n    btn.textContent = 'Restart';\n    renderAll();\n  } else {\n    game.restart();\n    btn.classList.remove('restart');\n    btn.classList.add('start');\n    btn.textContent = 'Start';\n    renderAll();\n  }\n});\n\ndocument.addEventListener('keydown', (e) => {\n  const st = game.getStatus();\n\n  if (!['playing', 'running'].includes(st)) {\n    return;\n  }\n\n  const map = {\n    ArrowLeft: () => game.moveLeft(),\n    ArrowRight: () => game.moveRight(),\n    ArrowUp: () => game.moveUp(),\n    ArrowDown: () => game.moveDown(),\n  };\n\n  const fn = map[e.key];\n\n  if (fn) {\n    fn();\n    renderAll();\n  }\n});\n\nrenderAll();\n","class Game {\n  constructor(initialState) {\n    this.size = 4;\n\n    this._emptyBoard = () =>\n      Array.from({ length: this.size }, () => Array(this.size).fill(0));\n\n    this.field = this._emptyBoard();\n    this.score = 0;\n    this.status = 'idle';\n\n    if (Array.isArray(initialState)) {\n      this.field = initialState.map((r) => r.slice());\n    } else if (initialState && Array.isArray(initialState.field)) {\n      this.field = initialState.field.map((r) => r.slice());\n      this.score = Number(initialState.score || 0);\n      this.status = initialState.status || 'idle';\n    }\n\n    this._initialField = this.field.map((r) => r.slice());\n  }\n\n  _cloneField(field = this.field) {\n    return field.map((r) => r.slice());\n  }\n\n  _emptyCells() {\n    const res = [];\n\n    for (let r = 0; r < this.size; r++) {\n      for (let c = 0; c < this.size; c++) {\n        if (this.field[r][c] === 0) {\n          res.push([r, c]);\n        }\n      }\n    }\n\n    return res;\n  }\n\n  _spawnRandomTile() {\n    const empties = this._emptyCells();\n\n    if (!empties.length) {\n      return;\n    }\n\n    const [r, c] = empties[Math.floor(Math.random() * empties.length)];\n\n    this.field[r][c] = Math.random() < 0.9 ? 2 : 4;\n  }\n\n  _transpose(mat) {\n    const t = this._emptyBoard();\n\n    for (let r = 0; r < this.size; r++) {\n      for (let c = 0; c < this.size; c++) {\n        t[c][r] = mat[r][c];\n      }\n    }\n\n    return t;\n  }\n\n  _rowsEqual(a, b) {\n    for (let i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  _has2048() {\n    for (let r = 0; r < this.size; r++) {\n      for (let c = 0; c < this.size; c++) {\n        if (this.field[r][c] === 2048) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  _hasMoves() {\n    if (this._emptyCells().length) {\n      return true;\n    }\n\n    for (let r = 0; r < this.size; r++) {\n      for (let c = 0; c < this.size; c++) {\n        const v = this.field[r][c];\n\n        if (r + 1 < this.size && this.field[r + 1][c] === v) {\n          return true;\n        }\n\n        if (c + 1 < this.size && this.field[r][c + 1] === v) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  _compressAndMergeRowLeft(row) {\n    const vals = row.filter((x) => x !== 0);\n    const res = [];\n    let gained = 0;\n\n    for (let i = 0; i < vals.length; i++) {\n      if (vals[i] === vals[i + 1]) {\n        const merged = vals[i] * 2;\n\n        res.push(merged);\n        gained += merged;\n        i++;\n      } else {\n        res.push(vals[i]);\n      }\n    }\n\n    while (res.length < this.size) {\n      res.push(0);\n    }\n\n    return {\n      row: res,\n      gained,\n    };\n  }\n\n  _moveLeftCore(matrix) {\n    const newMat = [];\n    let totalGained = 0;\n    let changed = false;\n\n    for (let r = 0; r < this.size; r++) {\n      const { row: newRow, gained } = this._compressAndMergeRowLeft(matrix[r]);\n\n      newMat.push(newRow);\n      totalGained += gained;\n\n      if (!this._rowsEqual(matrix[r], newRow)) {\n        changed = true;\n      }\n    }\n\n    return {\n      matrix: newMat,\n      changed,\n      totalGained,\n    };\n  }\n\n  _applyMove(result) {\n    if (!result.changed) {\n      return false;\n    }\n\n    this.field = result.matrix;\n\n    if (result.totalGained > 0) {\n      this.score += result.totalGained;\n    }\n    this._spawnRandomTile();\n\n    if (this._has2048()) {\n      this.status = 'win';\n    } else if (!this._hasMoves()) {\n      this.status = 'lose';\n    }\n\n    return true;\n  }\n\n  getState() {\n    return this._cloneField();\n  }\n\n  getScore() {\n    return this.score;\n  }\n\n  getStatus() {\n    if (this.status === 'running') {\n      return 'playing';\n    }\n\n    return this.status;\n  }\n\n  start() {\n    this.status = 'running';\n    this._spawnRandomTile();\n    this._spawnRandomTile();\n  }\n\n  restart() {\n    this.field = this._initialField.map((r) => r.slice());\n    this.score = 0;\n    this.status = 'idle';\n  }\n\n  moveLeft() {\n    if (this.status !== 'running') {\n      return false;\n    }\n\n    const res = this._moveLeftCore(this.field);\n\n    return this._applyMove(res);\n  }\n\n  moveRight() {\n    if (this.status !== 'running') {\n      return false;\n    }\n\n    const reversed = this.field.map((r) => r.slice().reverse());\n    const res = this._moveLeftCore(reversed);\n\n    res.matrix = res.matrix.map((r) => r.reverse());\n\n    return this._applyMove(res);\n  }\n\n  moveUp() {\n    if (this.status !== 'running') {\n      return false;\n    }\n\n    const t = this._transpose(this.field);\n    const res = this._moveLeftCore(t);\n\n    res.matrix = this._transpose(res.matrix);\n\n    return this._applyMove(res);\n  }\n\n  moveDown() {\n    if (this.status !== 'running') {\n      return false;\n    }\n\n    const t = this._transpose(this.field).map((r) => r.reverse());\n    const res = this._moveLeftCore(t);\n\n    res.matrix = this._transpose(res.matrix.map((r) => r.reverse()));\n\n    return this._applyMove(res);\n  }\n}\n\nexport default Game;\n"],"names":["$09e991522ca7e64e$var$game","constructor","initialState","size","_emptyBoard","Array","from","length","fill","field","score","status","isArray","map","r","slice","Number","_initialField","_cloneField","_emptyCells","res","c","push","_spawnRandomTile","empties","Math","floor","random","_transpose","mat","t","_rowsEqual","a","b","i","_has2048","_hasMoves","v","_compressAndMergeRowLeft","row","vals","filter","x","gained","merged","_moveLeftCore","matrix","newMat","totalGained","changed","newRow","_applyMove","result","getState","getScore","getStatus","start","restart","moveLeft","moveRight","reversed","reverse","moveUp","moveDown","$09e991522ca7e64e$var$cells","$09e991522ca7e64e$var$rows","$09e991522ca7e64e$var$fieldTable","document","querySelector","querySelectorAll","$09e991522ca7e64e$var$scoreEl","$09e991522ca7e64e$var$startMsg","$09e991522ca7e64e$var$winMsg","$09e991522ca7e64e$var$loseMsg","$09e991522ca7e64e$var$btn","$09e991522ca7e64e$var$setScoreText","str","textContent","setAttribute","$09e991522ca7e64e$var$renderAll","$09e991522ca7e64e$var$renderField","state","td","className","String","classList","add","$09e991522ca7e64e$var$renderMessages","st","remove","$09e991522ca7e64e$var$renderScore","val","addEventListener","contains","e","includes","fn","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","key"],"version":3,"file":"index.3bcff11c.js.map"}